---
import { docsNavigation, isActiveLink, isActiveSection } from '../../utils/navigation';

interface Props {
  currentPath: string;
}

const { currentPath } = Astro.props;
---

<!-- Desktop Sidebar -->
<aside class="hidden lg:block w-64 shrink-0">
  <nav class="sticky top-20 max-h-[calc(100vh-6rem)] overflow-y-auto pr-4 pb-8">
    <ul class="space-y-1">
      {docsNavigation.map((item) => (
        <li>
          {item.children ? (
            <div class="mb-2">
              <a
                href={item.href}
                class:list={[
                  "block py-1.5 text-sm font-medium font-mono transition-colors",
                  isActiveSection(currentPath, item)
                    ? "text-white"
                    : "text-[#a1a1a1] hover:text-white"
                ]}
              >
                {item.label}
              </a>
              <ul class="ml-3 mt-1 space-y-0.5 border-l border-[#262626]">
                {item.children.map((child) => (
                  <li>
                    <a
                      href={child.href}
                      class:list={[
                        "block py-1 pl-3 text-sm transition-colors border-l -ml-px",
                        isActiveLink(currentPath, child.href)
                          ? "text-white border-white"
                          : "text-[#a1a1a1] hover:text-white border-transparent hover:border-[#404040]"
                      ]}
                    >
                      {child.label}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ) : (
            <a
              href={item.href}
              class:list={[
                "block py-1.5 text-sm font-medium font-mono transition-colors",
                isActiveLink(currentPath, item.href)
                  ? "text-white"
                  : "text-[#a1a1a1] hover:text-white"
              ]}
            >
              {item.label}
            </a>
          )}
        </li>
      ))}
    </ul>
  </nav>
</aside>

<!-- Mobile Sidebar Toggle -->
<button
  id="docs-sidebar-toggle"
  class="fixed bottom-6 right-6 z-50 flex h-12 w-12 items-center justify-center rounded-full bg-white text-black shadow-lg lg:hidden"
  aria-label="Toggle navigation"
>
  <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
  </svg>
</button>

<!-- Mobile Sidebar Overlay -->
<div
  id="docs-sidebar-overlay"
  class="fixed inset-0 z-40 bg-black/50 opacity-0 pointer-events-none transition-opacity lg:hidden"
></div>

<!-- Mobile Sidebar Panel -->
<div
  id="docs-sidebar-panel"
  class="fixed inset-y-0 left-0 z-50 w-72 bg-[#0a0a0a] border-r border-[#262626] transform -translate-x-full transition-transform lg:hidden"
>
  <div class="flex items-center justify-between px-6 py-4 border-b border-[#262626]">
    <span class="font-mono text-sm font-medium">Navigation</span>
    <button id="docs-sidebar-close" class="p-1" aria-label="Close navigation">
      <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
  <nav class="overflow-y-auto h-[calc(100%-4rem)] px-6 py-4">
    <ul class="space-y-1">
      {docsNavigation.map((item) => (
        <li>
          {item.children ? (
            <div class="mb-2">
              <a
                href={item.href}
                class:list={[
                  "block py-1.5 text-sm font-medium font-mono transition-colors",
                  isActiveSection(currentPath, item)
                    ? "text-white"
                    : "text-[#a1a1a1] hover:text-white"
                ]}
              >
                {item.label}
              </a>
              <ul class="ml-3 mt-1 space-y-0.5 border-l border-[#262626]">
                {item.children.map((child) => (
                  <li>
                    <a
                      href={child.href}
                      class:list={[
                        "block py-1 pl-3 text-sm transition-colors border-l -ml-px",
                        isActiveLink(currentPath, child.href)
                          ? "text-white border-white"
                          : "text-[#a1a1a1] hover:text-white border-transparent hover:border-[#404040]"
                      ]}
                    >
                      {child.label}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ) : (
            <a
              href={item.href}
              class:list={[
                "block py-1.5 text-sm font-medium font-mono transition-colors",
                isActiveLink(currentPath, item.href)
                  ? "text-white"
                  : "text-[#a1a1a1] hover:text-white"
              ]}
            >
              {item.label}
            </a>
          )}
        </li>
      ))}
    </ul>
  </nav>
</div>

<script>
  const toggle = document.getElementById('docs-sidebar-toggle');
  const close = document.getElementById('docs-sidebar-close');
  const overlay = document.getElementById('docs-sidebar-overlay');
  const panel = document.getElementById('docs-sidebar-panel');

  function openSidebar() {
    panel?.classList.remove('-translate-x-full');
    overlay?.classList.remove('opacity-0', 'pointer-events-none');
    overlay?.classList.add('opacity-100');
    document.body.style.overflow = 'hidden';
  }

  function closeSidebar() {
    panel?.classList.add('-translate-x-full');
    overlay?.classList.add('opacity-0', 'pointer-events-none');
    overlay?.classList.remove('opacity-100');
    document.body.style.overflow = '';
  }

  toggle?.addEventListener('click', openSidebar);
  close?.addEventListener('click', closeSidebar);
  overlay?.addEventListener('click', closeSidebar);
</script>
